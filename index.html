<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Entrega de Materiais</title>
  <style>
    * { box-sizing: border-box; }

    body {
      font-family: Arial, sans-serif;
      margin: 10px;
      background: #f9f9f9;
    }

    h1 {
      text-align: center;
      color: #333;
      margin-bottom: 20px;
    }

    label {
      font-weight: bold;
      display: block;
      margin-top: 10px;
      margin-bottom: 5px;
    }

    input[type="text"], input[type="number"] {
      width: 100%;
      max-width: 100%;
      padding: 10px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }

    .linha {
      display: flex;
      gap: 5px;
      margin-bottom: 10px;
    }

    .linha input {
      flex: 1;
    }

    .linha button {
      padding: 10px;
      font-size: 18px;
      border-radius: 5px;
      border: none;
      background-color: #ccc;
      color: #000;
    }

    .quantidade-control {
      display: flex;
      gap: 5px;
      align-items: center;
      margin-top: 5px;
    }

    .quantidade-control button {
      width: 30px;
      height: 30px;
      font-size: 20px;
      border-radius: 5px;
      border: none;
      background-color: #eee;
    }

    .carrinho {
      margin-top: 20px;
      border-top: 1px solid #ccc;
      padding-top: 10px;
    }

    .carrinho-item {
      background: #fff;
      padding: 10px;
      margin-bottom: 8px;
      border: 1px solid #ddd;
      border-radius: 5px;
    }

    .finalizar {
      margin-top: 20px;
      background: #fff;
      padding: 10px;
      border-radius: 5px;
      border: 1px solid #ccc;
      display: none;
    }

    .finalizar input {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      margin-bottom: 10px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }

    .btn-principal {
      background-color: #4CAF50;
      color: white;
      font-size: 16px;
      padding: 12px;
      width: 100%;
      border: none;
      border-radius: 5px;
      margin-top: 10px;
    }
  </style>
</head>
<body>

  <h1>Entrega de Materiais</h1>

  <!-- C√≥digo de barras + manual -->
  <label>C√≥digo de barras ou manual:</label>
  <div class="linha">
    <input type="text" id="codigo" placeholder="C√≥digo de barras" onblur="buscarDescricao()">
    <button disabled>üì∑</button>
  </div>

  <!-- Descri√ß√£o -->
  <label>Descri√ß√£o:</label>
  <input type="text" id="descricao" placeholder="Descri√ß√£o do produto" readonly>

  <!-- Quantidade -->
  <label>Quantidade:</label>
  <div class="quantidade-control">
    <button onclick="alterarQuantidade(-1)">‚àí</button>
    <input type="number" id="quantidade" value="1" min="1">
    <button onclick="alterarQuantidade(1)">+</button>
  </div>

  <!-- Bot√£o adicionar -->
  <button class="btn-principal" onclick="adicionarItem()">Adicionar ao carrinho</button>

  <!-- Carrinho -->
  <div class="carrinho" id="carrinho">
    <h3>Itens adicionados:</h3>
  </div>

  <!-- Campos finais -->
  <div class="finalizar" id="finalizar">
    <label>Transa√ß√£o (3 caracteres):</label>
    <input type="text" maxlength="3">

    <label>Centro de Custo (6 caracteres):</label>
    <input type="text" maxlength="6">

    <label>Solicitante:</label>
    <input type="text">

    <label>Respons√°vel pelo Atendimento:</label>
    <input type="text">

    <button class="btn-principal">Finalizar Entrega</button>
  </div>

  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbzrUd51_l3if4GdFaVHYtxvYfznpHH5TN16GgB9yFZHQwNYOE30QKJTuawEtQa914hm/exec";

    function alterarQuantidade(valor) {
      const campo = document.getElementById("quantidade");
      let atual = parseInt(campo.value) || 1;
      atual = Math.max(1, atual + valor);
      campo.value = atual;
    }

    async function buscarDescricao() {
      const codigo = document.getElementById("codigo").value.trim();
      if (!codigo) return;

      try {
        const res = await fetch(`${API_URL}?codigo=${codigo}`);
        const json = await res.json();
        if (json.descricao) {
          document.getElementById("descricao").value = json.descricao;
        } else {
          document.getElementById("descricao").value = "Produto n√£o encontrado";
        }
      } catch (e) {
        document.getElementById("descricao").value = "Erro na busca";
      }
    }

    function adicionarItem() {
      const codigo = document.getElementById("codigo").value.trim();
      const descricao = document.getElementById("descricao").value.trim();
      const quantidade = document.getElementById("quantidade").value;

      if (!codigo || !descricao || !quantidade || descricao === "Produto n√£o encontrado") {
        alert("Preencha um c√≥digo v√°lido e aguarde a descri√ß√£o.");
        return;
      }

      const item = document.createElement("div");
      item.className = "carrinho-item";
      item.innerText = `C√≥digo: ${codigo} | Descri√ß√£o: ${descricao} | Quantidade: ${quantidade}`;
      document.getElementById("carrinho").appendChild(item);

      // Mostrar campos finais
      document.getElementById("finalizar").style.display = "block";

      // Limpar campos
      document.getElementById("codigo").value = "";
      document.getElementById("descricao").value = "";
      document.getElementById("quantidade").value = 1;
    }
  </script>

</body>
</html>
